  <!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8D-Report VDA Tool ‚Äì Juracom</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1, h2 { margin-top: 20px; }
    fieldset { margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; }
    legend { font-weight: bold; }
    label { display: block; margin-top: 8px; font-size: 14px; }
    textarea, input, select { width: 100%; box-sizing: border-box; padding: 6px; font-size: 14px; }
    .two-column { display: flex; gap: 10px; }
    .two-column > div { flex: 1; }
    .error { color: red; font-weight: bold; }
    .ok { color: green; font-weight: bold; }
    .toolbar { margin: 20px 0; padding: 10px; background: #f5f5f5; border-radius: 4px; }
    button { margin-right: 10px; padding: 8px 16px; cursor: pointer; }

    /* PDF-Layout Styles */
    #pdfLayout {
      position: relative;
    }
    .watermark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-45deg);
      font-size: 80px;
      color: rgba(255, 0, 0, 0.15);
      font-weight: bold;
      pointer-events: none;
      z-index: 1000;
      white-space: nowrap;
    }
    .vda-section {
      border: 1px solid #000;
      margin-bottom: 3mm;
      page-break-inside: avoid;
    }
    .vda-header {
      background: #eee;
      font-weight: bold;
      font-size: 9px;
      padding: 2px 3px;
      border-bottom: 1px solid #000;
    }
    .vda-body {
      padding: 2px 3px;
      min-height: 12mm;
      font-size: 8px;
      word-wrap: break-word;
    }
  </style>

  <!-- SheetJS f√ºr Excel-Export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- html2pdf f√ºr PDF-Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <h1 data-i18n="title">VDA 8D-Report Tool ‚Äì Juracom</h1>
  <p data-i18n="subtitle">Erfassen, pr√ºfen und exportieren von 8D-Reports (Kunde / Lieferant, VDA-konform, D4/D5 separiert).</p>

  <div class="toolbar">
    <label for="langSelect"><strong data-i18n="lang.label">Sprache / Language / ËØ≠Ë®Ä:</strong></label>
    <select id="langSelect" onchange="setLanguage(this.value)" style="width: 200px; margin-bottom: 10px;">
      <option value="de">Deutsch</option>
      <option value="en">English</option>
      <option value="zh">‰∏≠Êñá</option>
    </select>
    <br>
    <button type="button" onclick="validateReport()" data-i18n="buttons.validate">Report pr√ºfen</button>
    <button type="button" onclick="exportPDF()" data-i18n="buttons.pdf">Als PDF exportieren</button>
    <button type="button" onclick="exportExcel()" data-i18n="buttons.excel">Als Excel exportieren</button>
    <button type="button" onclick="unlockFullVersion()">Spende-Code</button>
    <span id="validationResult"></span>
  </div>

  <!-- Beispiel-F√§lle -->
  <div style="margin-bottom:15px;">
    <span data-i18n="examples.label"><strong>Beispielfall w√§hlen:</strong></span>
    <button type="button" onclick="loadExample(1)" title="unterirdisch">üí©</button>
    <button type="button" onclick="loadExample(2)" title="schwach">‚ö†Ô∏è</button>
    <button type="button" onclick="loadExample(3)" title="mittel">‚ûñ</button>
    <button type="button" onclick="loadExample(4)" title="gut">üëç</button>
    <button type="button" onclick="loadExample(5)" title="hervorragend">üèÜ</button>
  </div>

  <!-- Formular 8D -->
  <form id="form8D">
    <!-- Meta / Kopf -->
    <fieldset>
      <legend data-i18n="head.stammdaten">Stammdaten / Kopf</legend>
      <div class="two-column">
        <div>
          <label data-i18n="head.role">Rolle:</label>
          <select id="role" name="role">
            <option value="kunde" data-i18n="role.customer">Kunde</option>
            <option value="lieferant" data-i18n="role.supplier">Lieferant</option>
            <option value="intern" data-i18n="role.internal">Intern</option>
          </select>
        </div>
        <div>
          <label data-i18n="head.reportId">8D-Nummer / Reklamationsnummer:</label>
          <input type="text" id="reportId" name="reportId" />
        </div>
      </div>

      <div class="two-column">
        <div>
          <label data-i18n="head.customer">Kunde:</label>
          <input type="text" id="customer" name="customer" />
        </div>
        <div>
          <label data-i18n="head.supplier">Lieferant:</label>
          <input type="text" id="supplier" name="supplier" />
        </div>
      </div>

      <div class="two-column">
        <div>
          <label data-i18n="head.date">Datum:</label>
          <input type="date" id="date" name="date" />
        </div>
        <div>
          <label data-i18n="head.partNumber">Teil / Artikel / Zeichnungsnummer:</label>
          <input type="text" id="partNumber" name="partNumber" />
        </div>
      </div>
    </fieldset>

    <!-- D1 -->
    <fieldset>
      <legend data-i18n="d1.title">D1 ‚Äì Team</legend>
      <label data-i18n="d1.desc">Teammitglieder / Funktionen:</label>
      <textarea id="d1_team" rows="3"></textarea>
    </fieldset>

    <!-- D2 -->
    <fieldset>
      <legend data-i18n="d2.title">D2 ‚Äì Problembeschreibung</legend>
      <label data-i18n="d2.desc">Problembeschreibung (Was, Wo, Wann, Wie viele, etc.):</label>
      <textarea id="d2_problem" rows="4"></textarea>
    </fieldset>

    <!-- D3 -->
    <fieldset>
      <legend data-i18n="d3.title">D3 ‚Äì Sofortma√ünahmen (Containment)</legend>
      <label data-i18n="d3.desc">Getroffene Sofortma√ünahmen:</label>
      <textarea id="d3_containment" rows="3"></textarea>
    </fieldset>

    <!-- D4 -->
    <fieldset>
      <legend data-i18n="d4.title">D4 ‚Äì Ursachenanalyse (Occurrence / Detection separiert)</legend>

      <div style="margin-bottom:8px;">
        <button type="button" onclick="toggleFishbone()" data-i18n="d4.fishbone_btn">Fishbone (Ishikawa) √∂ffnen</button>
        <button type="button" onclick="toggleFiveWhy()" data-i18n="d4.why_btn">5 Why √∂ffnen</button>
      </div>

      <label data-i18n="d4.tua_label">Technische Ursachen ‚Äì Auftreten (TUA):</label>
      <textarea id="d4_tua" rows="3"></textarea>

      <label data-i18n="d4.tun_label">Technische Ursachen ‚Äì Nicht-Entdecken (TUN):</label>
      <textarea id="d4_tun" rows="3"></textarea>

      <label data-i18n="d4.sua_label">Systemische Ursachen ‚Äì Auftreten (SUA):</label>
      <textarea id="d4_sua" rows="3"></textarea>

      <label data-i18n="d4.sun_label">Systemische Ursachen ‚Äì Nicht-Entdecken (SUN):</label>
      <textarea id="d4_sun" rows="3"></textarea>

      <!-- Fishbone Bereich -->
      <div id="fishboneSection" style="display:none; margin-top:10px; border:1px dashed #999; padding:8px;">
        <strong data-i18n="d4.fishbone_title">Fishbone / Ishikawa (Text-Form)</strong>
        <p data-i18n="d4.fishbone_hint">Nutzen Sie die 6M (Mensch, Maschine, Material, Methode, Milieu, Messung), um m√∂gliche Ursachen zu sammeln.</p>
        <div class="two-column">
          <div>
            <label data-i18n="d4.fb_man">Mensch (Man):</label>
            <textarea id="fb_man" rows="2"></textarea>
            <label data-i18n="d4.fb_machine">Maschine (Machine):</label>
            <textarea id="fb_machine" rows="2"></textarea>
            <label data-i18n="d4.fb_material">Material:</label>
            <textarea id="fb_material" rows="2"></textarea>
          </div>
          <div>
            <label data-i18n="d4.fb_method">Methode (Method):</label>
            <textarea id="fb_method" rows="2"></textarea>
            <label data-i18n="d4.fb_env">Umgebung (Milieu/Environment):</label>
            <textarea id="fb_env" rows="2"></textarea>
            <label data-i18n="d4.fb_measure">Messung (Measurement):</label>
            <textarea id="fb_measure" rows="2"></textarea>
          </div>
        </div>
      </div>

      <!-- 5-Why Bereich -->
      <div id="fiveWhySection" style="display:none; margin-top:10px; border:1px dashed #999; padding:8px;">
        <strong data-i18n="d4.why_title">5 Why Analyse</strong>
        <p data-i18n="d4.why_hint">Beginnen Sie mit dem Symptom und fragen Sie f√ºnfmal ‚ÄûWarum?‚Äú.</p>
        <label data-i18n="d4.why1">Warum 1:</label>
        <textarea id="why1" rows="2"></textarea>
        <label data-i18n="d4.why2">Warum 2:</label>
        <textarea id="why2" rows="2"></textarea>
        <label data-i18n="d4.why3">Warum 3:</label>
        <textarea id="why3" rows="2"></textarea>
        <label data-i18n="d4.why4">Warum 4:</label>
        <textarea id="why4" rows="2"></textarea>
        <label data-i18n="d4.why5">Warum 5 (Root Cause):</label>
        <textarea id="why5" rows="2"></textarea>
      </div>
    </fieldset>

    <!-- D5 -->
    <fieldset>
      <legend data-i18n="d5.title">D5 ‚Äì Dauerhafte Abstellma√ünahmen</legend>
      <div class="two-column">
        <div>
          <label data-i18n="d5.occ_label">Occurrence (Auftreten verhindern):</label>
          <textarea id="d5_occurrence" rows="4"></textarea>
        </div>
        <div>
          <label data-i18n="d5.det_label">Detection (Erkennung verbessern):</label>
          <textarea id="d5_detection" rows="4"></textarea>
        </div>
      </div>
    </fieldset>

    <!-- D6 MIT TABELLE -->
    <fieldset>
      <legend data-i18n="d6.title">D6 ‚Äì Umsetzung der Ma√ünahmen</legend>
      <p data-i18n="d6.desc">Umzusetzende Ma√ünahmen inkl. Verantwortlicher und Termin:</p>

      <button type="button" onclick="addD6Row()" data-i18n="d6.add_btn">+ Ma√ünahme hinzuf√ºgen</button>

      <table id="d6_table" style="width:100%; border-collapse:collapse; margin-top:10px;">
        <thead>
          <tr style="background:#eee;">
            <th style="border:1px solid #ccc; padding:4px;" data-i18n="d6.col_action">Ma√ünahme</th>
            <th style="border:1px solid #ccc; padding:4px; width:150px;" data-i18n="d6.col_responsible">Verantwortlicher</th>
            <th style="border:1px solid #ccc; padding:4px; width:120px;" data-i18n="d6.col_date">Termin</th>
            <th style="border:1px solid #ccc; padding:4px; width:100px;" data-i18n="d6.col_status">Status</th>
            <th style="border:1px solid #ccc; padding:4px; width:50px;"></th>
          </tr>
        </thead>
        <tbody id="d6_tbody">
          <!-- Zeilen werden dynamisch hinzugef√ºgt -->
        </tbody>
      </table>
    </fieldset>

    <!-- D7 -->
    <fieldset>
      <legend data-i18n="d7.title">D7 ‚Äì Vorbeugende Ma√ünahmen / Lessons Learned</legend>
      <label data-i18n="d7.desc">√úbertrag auf √§hnliche Produkte / Prozesse, Standards, FMEAs:</label>
      <textarea id="d7_preventive" rows="4"></textarea>
    </fieldset>

    <!-- D8 -->
    <fieldset>
      <legend data-i18n="d8.title">D8 ‚Äì Erfolgskontrolle und Abschluss</legend>
      <label data-i18n="d8.verif">Nachweis der Wirksamkeit (Daten, Messwerte, Reklamationsr√ºckgang, etc.):</label>
      <textarea id="d8_verification" rows="4"></textarea>
      <label data-i18n="d8.closure">Teamw√ºrdigung / Abschluss:</label>
      <textarea id="d8_closure" rows="2"></textarea>
    </fieldset>
  </form>

  <!-- PDF-Layout (f√ºr Export) -->
  <div id="pdfLayout" style="display:none; font-family: Arial, sans-serif; font-size:10px;">
    <!-- Wasserzeichen -->
    <div id="watermark" class="watermark" data-i18n="watermark.text">DEMO - Nicht bezahlt</div>

    <div id="pdfPage" style="width:210mm; min-height:297mm; padding:10mm; box-sizing:border-box; position: relative;">

      <!-- Kopfbereich -->
      <table style="width:100%; border-collapse:collapse; margin-bottom:4mm;">
        <tr>
          <td style="width:25%; border:1px solid #000; text-align:center; padding:2mm; vertical-align:middle;">
            <div style="font-weight:bold; font-size:14px;">Juracom</div>
            <div style="font-size:8px;">Logo</div>
          </td>
          <td style="width:50%; border-top:1px solid #000; border-bottom:1px solid #000; text-align:center; vertical-align:middle;">
            <div style="font-weight:bold; font-size:14px;">8D-REPORT</div>
            <div style="font-size:8px;" data-i18n="pdf.subtitle">nach VDA-Standard</div>
          </td>
          <td style="width:25%; border:1px solid #000; font-size:8px; padding:2mm; vertical-align:top;">
            <div><strong data-i18n="pdf.reportId">8D-Nr.:</strong> <span id="pdf_reportId"></span></div>
            <div><strong data-i18n="pdf.date">Datum:</strong> <span id="pdf_date"></span></div>
          </td>
        </tr>
      </table>

      <!-- Stammdaten -->
      <table style="width:100%; border-collapse:collapse; margin-bottom:3mm; font-size:8px;">
        <tr>
          <td style="border:1px solid #000; padding:1mm;">
            <strong data-i18n="pdf.customer">Kunde:</strong> <span id="pdf_customer"></span>
          </td>
          <td style="border:1px solid #000; padding:1mm;">
            <strong data-i18n="pdf.supplier">Lieferant:</strong> <span id="pdf_supplier"></span>
          </td>
          <td style="border:1px solid #000; padding:1mm;">
            <strong data-i18n="pdf.partNumber">Teil / Zeichnungsnr.:</strong> <span id="pdf_partNumber"></span>
          </td>
        </tr>
      </table>

      <!-- D1 -->
      <div class="vda-section">
        <div class="vda-header" data-i18n="d1.title">D1 ‚Äì Team</div>
        <div class="vda-body" id="pdf_d1"></div>
      </div>

      <!-- D2 -->
      <div class="vda-section">
        <div class="vda-header" data-i18n="d2.title">D2 ‚Äì Problembeschreibung</div>
        <div class="vda-body" id="pdf_d2"></div>
      </div>

      <!-- D3 -->
      <div class="vda-section">
        <div class="vda-header" data-i18n="d3.title">D3 ‚Äì Sofortma√ünahmen</div>
        <div class="vda-body" id="pdf_d3"></div>
      </div>

      <!-- D4 -->
      <div class="vda-section">
        <div class="vda-header" data-i18n="pdf.d4_title">D4 ‚Äì Ursachenanalyse (TUA / TUN / SUA / SUN)</div>
        <table style="width:100%; border-collapse:collapse; font-size:8px;">
          <tr>
            <td style="border:1px solid #000; width:25%; vertical-align:top; padding:1mm;">
              <strong data-i18n="d4.tua">TUA</strong><br>
              <div id="pdf_d4_tua"></div>
            </td>
            <td style="border:1px solid #000; width:25%; vertical-align:top; padding:1mm;">
              <strong data-i18n="d4.tun">TUN</strong><br>
              <div id="pdf_d4_tun"></div>
            </td>
            <td style="border:1px solid #000; width:25%; vertical-align:top; padding:1mm;">
              <strong data-i18n="d4.sua">SUA</strong><br>
              <div id="pdf_d4_sua"></div>
            </td>
            <td style="border:1px solid #000; width:25%; vertical-align:top; padding:1mm;">
              <strong data-i18n="d4.sun">SUN</strong><br>
              <div id="pdf_d4_sun"></div>
            </td>
          </tr>
        </table>
      </div>

      <!-- D5 -->
      <div class="vda-section">
        <div class="vda-header" data-i18n="d5.title">D5 ‚Äì Dauerhafte Abstellma√ünahmen</div>
        <table style="width:100%; border-collapse:collapse; font-size:8px;">
          <tr>
            <td style="border:1px solid #000; width:50%; vertical-align:top; padding:1mm;">
              <strong data-i18n="d5.occ">Occurrence (Auftreten verhindern)</strong><br>
              <div id="pdf_d5_occurrence"></div>
            </td>
            <td style="border:1px solid #000; width:50%; vertical-align:top; padding:1mm;">
              <strong data-i18n="d5.det">Detection (Entdeckung verbessern)</strong><br>
              <div id="pdf_d5_detection"></div>
            </td>
          </tr>
        </table>
      </div>

      <!-- D6 -->
      <div class="vda-section">
        <div class="vda-header" data-i18n="d6.title">D6 ‚Äì Umsetzung der Ma√ünahmen</div>
        <div class="vda-body" id="pdf_d6"></div>
      </div>

      <!-- D7 -->
      <div class="vda-section">
        <div class="vda-header" data-i18n="d7.title">D7 ‚Äì Vorbeugende Ma√ünahmen</div>
        <div class="vda-body" id="pdf_d7"></div>
      </div>

      <!-- D8 -->
      <div class="vda-section">
        <div class="vda-header" data-i18n="d8.title">D8 ‚Äì Erfolgskontrolle / Abschluss</div>
        <div class="vda-body">
          <strong data-i18n="d8.verif">Wirksamkeitsnachweis:</strong><br>
          <div id="pdf_d8_verification" style="margin-bottom:2mm;"></div>
          <strong data-i18n="d8.closure">Abschluss / Teamw√ºrdigung:</strong><br>
          <div id="pdf_d8_closure"></div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // Sprachdaten
    const translations = {
      de: {
        title: "VDA 8D-Report Tool ‚Äì Juracom",
        subtitle: "Erfassen, pr√ºfen und exportieren von 8D-Reports (Kunde / Lieferant, VDA-konform, D4/D5 separiert).",
        lang: { label: "Sprache / Language / ËØ≠Ë®Ä:" },
        buttons: {
          validate: "Report pr√ºfen",
          pdf: "Als PDF exportieren",
          excel: "Als Excel exportieren"
        },
        examples: {
          label: "Beispielfall w√§hlen:"
        },
        head: {
          stammdaten: "Stammdaten / Kopf",
          role: "Rolle:",
          reportId: "8D-Nummer / Reklamationsnummer:",
          customer: "Kunde:",
          supplier: "Lieferant:",
          date: "Datum:",
          partNumber: "Teil / Artikel / Zeichnungsnummer:"
        },
        role: {
          customer: "Kunde",
          supplier: "Lieferant",
          internal: "Intern"
        },
        d1: { title: "D1 ‚Äì Team", desc: "Teammitglieder / Funktionen:" },
        d2: { title: "D2 ‚Äì Problembeschreibung", desc: "Problembeschreibung (Was, Wo, Wann, Wie viele, etc.):" },
        d3: { title: "D3 ‚Äì Sofortma√ünahmen (Containment)", desc: "Getroffene Sofortma√ünahmen:" },
        d4: {
          title: "D4 ‚Äì Ursachenanalyse (Occurrence / Detection separiert)",
          tua_label: "Technische Ursachen ‚Äì Auftreten (TUA):",
          tun_label: "Technische Ursachen ‚Äì Nicht-Entdecken (TUN):",
          sua_label: "Systemische Ursachen ‚Äì Auftreten (SUA):",
          sun_label: "Systemische Ursachen ‚Äì Nicht-Entdecken (SUN):",
          tua: "TUA", tun: "TUN", sua: "SUA", sun: "SUN",
          fishbone_btn: "Fishbone (Ishikawa) √∂ffnen",
          why_btn: "5 Why √∂ffnen",
          fishbone_title: "Fishbone / Ishikawa (Text-Form)",
          fishbone_hint: "Nutzen Sie die 6M (Mensch, Maschine, Material, Methode, Milieu, Messung), um m√∂gliche Ursachen zu sammeln.",
          fb_man: "Mensch (Man):",
          fb_machine: "Maschine (Machine):",
          fb_material: "Material:",
          fb_method: "Methode (Method):",
          fb_env: "Umgebung (Milieu/Environment):",
          fb_measure: "Messung (Measurement):",
          why_title: "5 Why Analyse",
          why_hint: "Beginnen Sie mit dem Symptom und fragen Sie f√ºnfmal ‚ÄûWarum?‚Äú. ",
          why1: "Warum 1:",
          why2: "Warum 2:",
          why3: "Warum 3:",
          why4: "Warum 4:",
          why5: "Warum 5 (Root Cause):"
        },
        d5: {
          title: "D5 ‚Äì Dauerhafte Abstellma√ünahmen",
          occ_label: "Occurrence (Auftreten verhindern):",
          det_label: "Detection (Erkennung verbessern):",
          occ: "Occurrence (Auftreten verhindern)",
          det: "Detection (Entdeckung verbessern)"
        },
        d6: {
          title: "D6 ‚Äì Umsetzung der Ma√ünahmen",
          desc: "Umzusetzende Ma√ünahmen inkl. Verantwortlicher und Termin:",
          add_btn: "+ Ma√ünahme hinzuf√ºgen",
          col_action: "Ma√ünahme",
          col_responsible: "Verantwortlicher",
          col_date: "Termin",
          col_status: "Status"
        },
        d7: {
          title: "D7 ‚Äì Vorbeugende Ma√ünahmen / Lessons Learned",
          desc: "√úbertrag auf √§hnliche Produkte / Prozesse, Standards, FMEAs:"
        },
        d8: {
          title: "D8 ‚Äì Erfolgskontrolle und Abschluss",
          verif: "Nachweis der Wirksamkeit (Daten, Messwerte, Reklamationsr√ºckgang, etc.):",
          closure: "Teamw√ºrdigung / Abschluss:"
        },
        pdf: {
          subtitle: "nach VDA-Standard",
          reportId: "8D-Nr.:",
          date: "Datum:",
          customer: "Kunde:",
          supplier: "Lieferant:",
          partNumber: "Teil / Zeichnungsnr.:",
          d4_title: "D4 ‚Äì Ursachenanalyse (TUA / TUN / SUA / SUN)"
        },
        watermark: { text: "DEMO - Nicht bezahlt" },
        validation: {
          missing: "Fehlende / kritische Felder: ",
          ok: "Report ist formal vollst√§ndig (Basispr√ºfung und Plausibilit√§tscheck bestanden)."
        }
      },
      en: {
        title: "VDA 8D Report Tool ‚Äì Juracom",
        subtitle: "Create, review and export 8D reports (customer / supplier, VDA compliant, D4/D5 separated).",
        lang: { label: "Language / Sprache / ËØ≠Ë®Ä:" },
        buttons: {
          validate: "Validate report",
          pdf: "Export as PDF",
          excel: "Export as Excel"
        },
        examples: {
          label: "Select example case:"
        },
        head: {
          stammdaten: "Master data / Header",
          role: "Role:",
          reportId: "8D number / Complaint number:",
          customer: "Customer:",
          supplier: "Supplier:",
          date: "Date:",
          partNumber: "Part / Article / Drawing number:"
        },
        role: {
          customer: "Customer",
          supplier: "Supplier",
          internal: "Internal"
        },
        d1: { title: "D1 ‚Äì Team", desc: "Team members / functions:" },
        d2: { title: "D2 ‚Äì Problem description", desc: "Problem description (What, where, when, how many, etc.):" },
        d3: { title: "D3 ‚Äì Containment actions", desc: "Implemented containment actions:" },
        d4: {
          title: "D4 ‚Äì Root cause analysis (Occurrence / Detection separated)",
          tua_label: "Technical causes ‚Äì Occurrence (TUA):",
          tun_label: "Technical causes ‚Äì Non-Detection (TUN):",
          sua_label: "Systemic causes ‚Äì Occurrence (SUA):",
          sun_label: "Systemic causes ‚Äì Non-Detection (SUN):",
          tua: "TUA", tun: "TUN", sua: "SUA", sun: "SUN",
          fishbone_btn: "Open Fishbone (Ishikawa)",
          why_btn: "Open 5 Why",
          fishbone_title: "Fishbone / Ishikawa (text form)",
          fishbone_hint: "Use the 6M (Man, Machine, Material, Method, Milieu, Measurement) to collect possible causes.",
          fb_man: "Man:",
          fb_machine: "Machine:",
          fb_material: "Material:",
          fb_method: "Method:",
          fb_env: "Environment:",
          fb_measure: "Measurement:",
          why_title: "5 Why analysis",
          why_hint: "Start from the symptom and ask \"Why?\" five times.",
          why1: "Why 1:",
          why2: "Why 2:",
          why3: "Why 3:",
          why4: "Why 4:",
          why5: "Why 5 (root cause):"
        },
        d5: {
          title: "D5 ‚Äì Permanent corrective actions",
          occ_label: "Occurrence (prevent occurrence):",
          det_label: "Detection (improve detection):",
          occ: "Occurrence (prevent occurrence)",
          det: "Detection (improve detection)"
        },
        d6: {
          title: "D6 ‚Äì Implementation of actions",
          desc: "Actions including responsible and due date:",
          add_btn: "+ Add action",
          col_action: "Action",
          col_responsible: "Responsible",
          col_date: "Due date",
          col_status: "Status"
        },
        d7: {
          title: "D7 ‚Äì Preventive actions / Lessons learned",
          desc: "Transfer to similar products / processes, standards, FMEAs:"
        },
        d8: {
          title: "D8 ‚Äì Verification / closure",
          verif: "Verification of effectiveness (data, measurements, complaint reduction, etc.):",
          closure: "Team recognition / closure:"
        },
        pdf: {
          subtitle: "according to VDA standard",
          reportId: "8D No.:",
          date: "Date:",
          customer: "Customer:",
          supplier: "Supplier:",
          partNumber: "Part / Drawing No.:",
          d4_title: "D4 ‚Äì Root cause analysis (TUA / TUN / SUA / SUN)"
        },
        watermark: { text: "DEMO - Not paid" },
        validation: {
          missing: "Missing / critical fields: ",
          ok: "Report is formally complete (basic and plausibility checks passed)."
        }
      },
      zh: {
        title: "VDA 8D Êä•ÂëäÂ∑•ÂÖ∑ ‚Äì Juracom",
        subtitle: "ÂàõÂª∫„ÄÅÂÆ°Ê†∏Âπ∂ÂØºÂá∫ 8D Êä•ÂëäÔºàÂÆ¢Êà∑ / ‰æõÂ∫îÂïÜÔºåÁ¨¶Âêà VDA Ê†áÂáÜÔºåD4/D5 ÂéüÂõ†ÂàÜÁ¶ªÔºâ„ÄÇ",
        lang: { label: "ËØ≠Ë®Ä / Language / Sprache:" },
        buttons: {
          validate: "Ê£ÄÊü•Êä•Âëä",
          pdf: "ÂØºÂá∫‰∏∫ PDF",
          excel: "ÂØºÂá∫‰∏∫ Excel"
        },
        examples: {
          label: "ÈÄâÊã©Á§∫‰æãÊ°à‰æãÔºö"
        },
        head: {
          stammdaten: "‰∏ªÊï∞ÊçÆ / Â§¥ÈÉ®‰ø°ÊÅØ",
          role: "ËßíËâ≤Ôºö",
          reportId: "8D ÁºñÂè∑ / ÊäïËØâÁºñÂè∑Ôºö",
          customer: "ÂÆ¢Êà∑Ôºö",
          supplier: "‰æõÂ∫îÂïÜÔºö",
          date: "Êó•ÊúüÔºö",
          partNumber: "Èõ∂‰ª∂ / Áâ©Êñô / ÂõæÂè∑Ôºö"
        },
        role: {
          customer: "ÂÆ¢Êà∑",
          supplier: "‰æõÂ∫îÂïÜ",
          internal: "ÂÜÖÈÉ®"
        },
        d1: { title: "D1 ‚Äì Âõ¢Èòü", desc: "Âõ¢ÈòüÊàêÂëò / ËÅåËÉΩÔºö" },
        d2: { title: "D2 ‚Äì ÈóÆÈ¢òÊèèËø∞", desc: "ÈóÆÈ¢òÊèèËø∞ÔºàÊòØ‰ªÄ‰πà„ÄÅÂú®Âì™Èáå„ÄÅ‰ΩïÊó∂„ÄÅÊï∞ÈáèÁ≠âÔºâÔºö" },
        d3: { title: "D3 ‚Äì ÊöÇÊó∂Êé™ÊñΩÔºàÂõ¥Â†µÔºâ", desc: "Â∑≤ÈááÂèñÁöÑÊöÇÊó∂Êé™ÊñΩÔºö" },
        d4: {
          title: "D4 ‚Äì Ê†πÊú¨ÂéüÂõ†ÂàÜÊûêÔºàÂèëÁîü / Ê£ÄÊµãÂàÜÁ¶ªÔºâ",
          tua_label: "ÊäÄÊúØÂéüÂõ† ‚Äì ÂèëÁîü (TUA)Ôºö",
          tun_label: "ÊäÄÊúØÂéüÂõ† ‚Äì Êú™Ê£ÄÂá∫ (TUN)Ôºö",
          sua_label: "Á≥ªÁªüÂéüÂõ† ‚Äì ÂèëÁîü (SUA)Ôºö",
          sun_label: "Á≥ªÁªüÂéüÂõ† ‚Äì Êú™Ê£ÄÂá∫ (SUN)Ôºö",
          tua: "TUA", tun: "TUN", sua: "SUA", sun: "SUN",
          fishbone_btn: "ÊâìÂºÄÈ±ºÈ™®ÂõæÔºàÁü≥Â∑ùÔºâ",
          why_btn: "ÊâìÂºÄ 5 Why",
          fishbone_title: "È±ºÈ™®Âõæ / Áü≥Â∑ùÂõæÔºàÊñáÊú¨ÂΩ¢ÂºèÔºâ",
          fishbone_hint: "‰ΩøÁî® 6MÔºà‰∫∫„ÄÅÊú∫Âô®„ÄÅÊùêÊñô„ÄÅÊñπÊ≥ï„ÄÅÁéØÂ¢É„ÄÅÊµãÈáèÔºâÊî∂ÈõÜÂèØËÉΩÂéüÂõ†„ÄÇ",
          fb_man: "‰∫∫ÔºàManÔºâÔºö",
          fb_machine: "Êú∫Âô®ÔºàMachineÔºâÔºö",
          fb_material: "ÊùêÊñôÔºàMaterialÔºâÔºö",
          fb_method: "ÊñπÊ≥ïÔºàMethodÔºâÔºö",
          fb_env: "ÁéØÂ¢ÉÔºàEnvironmentÔºâÔºö",
          fb_measure: "ÊµãÈáèÔºàMeasurementÔºâÔºö",
          why_title: "5 Why ÂàÜÊûê",
          why_hint: "‰ªéÁóáÁä∂ÂºÄÂßãÔºåËøûÁª≠ÈóÆ‰∫îÊ¨°‚Äú‰∏∫‰ªÄ‰πàÔºü‚Äù„ÄÇ",
          why1: "‰∏∫‰ªÄ‰πà 1Ôºö",
          why2: "‰∏∫‰ªÄ‰πà 2Ôºö",
          why3: "‰∏∫‰ªÄ‰πà 3Ôºö",
          why4: "‰∏∫‰ªÄ‰πà 4Ôºö",
          why5: "‰∏∫‰ªÄ‰πà 5ÔºàÊ†πÊú¨ÂéüÂõ†ÔºâÔºö"
        },
        d5: {
          title: "D5 ‚Äì Ê∞∏‰πÖÁ∫†Ê≠£Êé™ÊñΩ",
          occ_label: "OccurrenceÔºàÈò≤Ê≠¢ÂÜçÊ¨°ÂèëÁîüÔºâÔºö",
          det_label: "DetectionÔºàÊèêÈ´òÊ£ÄÂá∫ËÉΩÂäõÔºâÔºö",
          occ: "OccurrenceÔºàÈò≤Ê≠¢ÂÜçÊ¨°ÂèëÁîüÔºâ",
          det: "DetectionÔºàÊèêÈ´òÊ£ÄÂá∫ËÉΩÂäõÔºâ"
        },
        d6: {
          title: "D6 ‚Äì Êé™ÊñΩÂÆûÊñΩ",
          desc: "ÂÆûÊñΩÊé™ÊñΩÔºàË¥£‰ªª‰∫∫ÂíåÂÆåÊàêÊúüÈôêÔºâÔºö",
          add_btn: "+ Ê∑ªÂä†Êé™ÊñΩ",
          col_action: "Êé™ÊñΩ",
          col_responsible: "Ë¥£‰ªª‰∫∫",
          col_date: "ÂÆåÊàêÊúüÈôê",
          col_status: "Áä∂ÊÄÅ"
        },
        d7: {
          title: "D7 ‚Äì È¢ÑÈò≤Êé™ÊñΩ / ÁªèÈ™åÊïôËÆ≠",
          desc: "Êé®ÂπøÂà∞Á±ª‰ºº‰∫ßÂìÅ / ËøáÁ®ã„ÄÅÊ†áÂáÜ„ÄÅFMEAÔºö"
        },
        d8: {
          title: "D8 ‚Äì ÊúâÊïàÊÄßÁ°ÆËÆ§ / ÁªìÊ°à",
          verif: "ÊúâÊïàÊÄßÁ°ÆËÆ§ÔºàÊï∞ÊçÆ„ÄÅÊµãÈáè„ÄÅÊäïËØâ‰∏ãÈôçÁ≠âÔºâÔºö",
          closure: "Âõ¢ÈòüË°®ÂΩ∞ / ÁªìÊ°àËØ¥ÊòéÔºö"
        },
        pdf: {
          subtitle: "Á¨¶Âêà VDA Ê†áÂáÜ",
          reportId: "8D ÁºñÂè∑Ôºö",
          date: "Êó•ÊúüÔºö",
          customer: "ÂÆ¢Êà∑Ôºö",
          supplier: "‰æõÂ∫îÂïÜÔºö",
          partNumber: "Èõ∂‰ª∂ / ÂõæÂè∑Ôºö",
          d4_title: "D4 ‚Äì Ê†πÊú¨ÂéüÂõ†ÂàÜÊûêÔºàTUA / TUN / SUA / SUNÔºâ"
        },
        watermark: { text: "ÊºîÁ§∫Áâà - Êú™‰ªòË¥π" },
        validation: {
          missing: "Áº∫Â∞ë / ÂÖ≥ÈîÆÂ≠óÊÆµÔºö",
          ok: "Êä•ÂëäÊ†ºÂºèÂÆåÊï¥ÔºàÂü∫Á°ÄÂíåÈÄªËæëÊ£ÄÊü•ÈÄöËøáÔºâ„ÄÇ"
        }
      }
    };

    let currentLang = 'de';
    let donated = false;

    function setLanguage(lang) {
      currentLang = lang;
      const dict = translations[lang] || translations.de;

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        const parts = key.split(".");
        let value = dict;
        parts.forEach(p => { if (value) value = value[p]; });
        if (typeof value === "string") {
          el.textContent = value;
        }
      });
    }

    // D6 dynamische Tabelle
    let d6RowCounter = 0;

    function addD6Row() {
      d6RowCounter++;
      const tbody = document.getElementById('d6_tbody');
      const row = document.createElement('tr');
      row.id = 'd6_row_' + d6RowCounter;
      row.innerHTML = `
        <td style="border:1px solid #ccc; padding:4px;">
          <textarea class="d6_action" rows="2" style="width:100%; box-sizing:border-box;"></textarea>
        </td>
        <td style="border:1px solid #ccc; padding:4px;">
          <input type="text" class="d6_responsible" style="width:100%; box-sizing:border-box;" />
        </td>
        <td style="border:1px solid #ccc; padding:4px;">
          <input type="date" class="d6_date" style="width:100%; box-sizing:border-box;" />
        </td>
        <td style="border:1px solid #ccc; padding:4px;">
          <select class="d6_status" style="width:100%; box-sizing:border-box;">
            <option value="offen">Offen</option>
            <option value="in_arbeit">In Arbeit</option>
            <option value="erledigt">Erledigt</option>
          </select>
        </td>
        <td style="border:1px solid #ccc; padding:4px; text-align:center;">
          <button type="button" onclick="deleteD6Row('${row.id}')" style="padding:2px 6px;">üóëÔ∏è</button>
        </td>
      `;
      tbody.appendChild(row);
    }

    function deleteD6Row(rowId) {
      const row = document.getElementById(rowId);
      if (row) row.remove();
    }

    function getD6Data() {
      const rows = [];
      document.querySelectorAll('#d6_tbody tr').forEach(row => {
        const action = row.querySelector('.d6_action')?.value || '';
        const responsible = row.querySelector('.d6_responsible')?.value || '';
        const date = row.querySelector('.d6_date')?.value || '';
        const status = row.querySelector('.d6_status')?.value || '';
        if (action || responsible || date) {
          rows.push({ action, responsible, date, status });
        }
      });
      return rows;
    }

    // Beispiele
    const examples = {
      1: {
        reportId: "EX-01",
        customer: "OEM A",
        supplier: "Juracom",
        date: "2026-02-25",
        partNumber: "12345-01",
        d1_team: "",
        d2_problem: "Teile sind schlecht.",
        d3_containment: "",
        d4_tua: "",
        d4_tun: "",
        d4_sua: "",
        d4_sun: "",
        d5_occurrence: "",
        d5_detection: "",
        d6_implementation: [],
        d7_preventive: "",
        d8_verification: "",
        d8_closure: ""
      },
      2: {
        reportId: "EX-02",
        customer: "OEM B",
        supplier: "Juracom",
        date: "2026-02-25",
        partNumber: "98765-02",
        d1_team: "QS, Produktion",
        d2_problem: "Hohe Ausschussrate an Linie 2, Poren im Druckguss.",
        d3_containment: "Sortierung der aktuellen Charge.",
        d4_tua: "Vermutlich falsche Temperatur, noch nicht best√§tigt.",
        d4_tun: "",
        d4_sua: "",
        d4_sun: "",
        d5_occurrence: "Temperatur genauer beobachten.",
        d5_detection: "",
        d6_implementation: [],
        d7_preventive: "",
        d8_verification: "",
        d8_closure: ""
      },
      3: {
        reportId: "EX-03",
        customer: "Tier1 C",
        supplier: "Juracom",
        date: "2026-02-25",
        partNumber: "CAST-4711",
        d1_team: "QS, Produktion, Werkzeugbau",
        d2_problem: "Poren im Bereich Dichtfl√§che, 4% Ausschuss nach Endpr√ºfung.",
        d3_containment: "100%-Pr√ºfung mit Druckpr√ºfung, Sperrung Lagerbestand.",
        d4_tua: "Metalltemperatur schwankt, Gie√üparameter nicht stabil.",
        d4_tun: "Endpr√ºfung pr√ºft nur Stichproben bei Zwischenpr√ºfung.",
        d4_sua: "",
        d4_sun: "",
        d5_occurrence: "Gie√üparameter in SOP fixieren und √ºberwachen.",
        d5_detection: "Zwischenpr√ºfung mit 100%-Pr√ºfung f√ºr 3 Wochen einf√ºhren.",
        d6_implementation: [],
        d7_preventive: "",
        d8_verification: "",
        d8_closure: ""
      },
      4: {
        reportId: "EX-04",
        customer: "OEM D",
        supplier: "Juracom",
        date: "2026-02-25",
        partNumber: "HOUSING-220",
        d1_team: "QS, Produktion, Konstruktion, Einkauf",
        d2_problem: "Rissbildung an Befestigungsbohrung nach Montage beim Kunden, 2,5% Feldreklamationen.",
        d3_containment: "Sofortiger Stopp Auslieferung, 100%-Sichtpr√ºfung.",
        d4_tua: "Materialkerbwirkung durch scharfe Kante an Bohrung, unzureichende Entgratung.",
        d4_tun: "Endpr√ºfung fokussiert aktuell nur auf Ma√ühaltigkeit, nicht auf Oberfl√§chenrisse.",
        d4_sua: "",
        d4_sun: "",
        d5_occurrence: "Bohrungsgeometrie anpassen, Fase erg√§nzen, Entgratungspflicht in Arbeitsanweisung.",
        d5_detection: "Endpr√ºfung um Risspr√ºfung an dieser Bohrung erg√§nzen.",
        d6_implementation: [
          { action: "Zeichnung anpassen", responsible: "Konstruktion", date: "2026-03-10", status: "erledigt" },
          { action: "Arbeitsanweisung aktualisieren", responsible: "Produktion", date: "2026-03-15", status: "in_arbeit" }
        ],
        d7_preventive: "Anpassung FMEA und Standardzeichnung f√ºr √§hnliche Bauteile.",
        d8_verification: "Nach 6 Monaten keine neuen Reklamationen, interne PPM deutlich gesunken.",
        d8_closure: "Team wird im Monatsmeeting gew√ºrdigt."
      },
      5: {
        reportId: "EX-05",
        customer: "OEM E",
        supplier: "Juracom",
        date: "2026-02-25",
        partNumber: "VALVE-BODY-900",
        d1_team: "QS, Produktion, Instandhaltung, Konstruktion, Lieferantenmanagement",
        d2_problem: "Leckage an Ventilgeh√§use im Feld, 1,8% R√ºckl√§ufer, Risiko f√ºr Endkunde (Funktionsausfall).",
        d3_containment: "Sperrung betroffener Chargen, 100%-Druckpr√ºfung, Information an Kunde mit Risikobewertung.",
        d4_tua: "O-Ring-Nut nicht prozesssicher hergestellt, Werkzeugverschlei√ü wurde nicht rechtzeitig erkannt.",
        d4_tun: "Pr√ºfkonzept bewertet nur Ma√ü X, keine Funktionspr√ºfung unter Betriebsdruck.",
        d4_sua: "Wartungsintervall f√ºr Werkzeug nicht definiert, keine klare Verantwortlichkeit.",
        d4_sun: "Kein standardisiertes Review von Pr√ºfpl√§nen bei Feldreklamationen.",
        d5_occurrence: "Werkzeugwartungsplan mit Grenzmustern einf√ºhren, SPC auf kritische Ma√üe.",
        d5_detection: "Druckpr√ºfung unter Betriebsdruck in Endpr√ºfung integrieren, Pr√ºfplan anpassen.",
        d6_implementation: [
          { action: "Wartungsplan erstellen", responsible: "Instandhaltung", date: "2026-03-05", status: "erledigt" },
          { action: "Pr√ºfplan √§ndern", responsible: "QS", date: "2026-03-12", status: "erledigt" },
          { action: "Schulung Produktion", responsible: "Produktion", date: "2026-03-20", status: "in_arbeit" }
        ],
        d7_preventive: "FMEA aktualisiert, Lessons Learned in Standard f√ºr Ventilgeh√§use aufgenommen, Reviewprozess f√ºr Pr√ºfpl√§ne definiert.",
        d8_verification: "12 Monate ohne Reklamation, PPM intern und extern signifikant reduziert, Audit best√§tigt Wirksamkeit.",
        d8_closure: "Team und Lieferantenpartner erhalten Anerkennung."
      }
    };

    function loadExample(n) {
      const ex = examples[n];
      if (!ex) return;
      const form = document.getElementById('form8D');

      form.reportId.value = ex.reportId || "";
      form.customer.value = ex.customer || "";
      form.supplier.value = ex.supplier || "";
      form.date.value = ex.date || "";
      form.partNumber.value = ex.partNumber || "";
      form.d1_team.value = ex.d1_team || "";
      form.d2_problem.value = ex.d2_problem || "";
      form.d3_containment.value = ex.d3_containment || "";
      form.d4_tua.value = ex.d4_tua || "";
      form.d4_tun.value = ex.d4_tun || "";
      form.d4_sua.value = ex.d4_sua || "";
      form.d4_sun.value = ex.d4_sun || "";
      form.d5_occurrence.value = ex.d5_occurrence || "";
      form.d5_detection.value = ex.d5_detection || "";
      form.d7_preventive.value = ex.d7_preventive || "";
      form.d8_verification.value = ex.d8_verification || "";
      form.d8_closure.value = ex.d8_closure || "";

      // D6 Tabelle f√ºllen
      document.getElementById('d6_tbody').innerHTML = '';
      d6RowCounter = 0;
      if (ex.d6_implementation && Array.isArray(ex.d6_implementation)) {
        ex.d6_implementation.forEach(item => {
          addD6Row();
          const lastRow = document.querySelector('#d6_tbody tr:last-child');
          if (lastRow) {
            lastRow.querySelector('.d6_action').value = item.action || '';
            lastRow.querySelector('.d6_responsible').value = item.responsible || '';
            lastRow.querySelector('.d6_date').value = item.date || '';
            lastRow.querySelector('.d6_status').value = item.status || 'offen';
          }
        });
      }
      validateReport();
    }

    // Show/Hide D4-Tools
    function toggleFishbone() {
      const sec = document.getElementById('fishboneSection');
      sec.style.display = (sec.style.display === 'none' || sec.style.display === '') ? 'block' : 'none';
    }

    function toggleFiveWhy() {
      const sec = document.getElementById('fiveWhySection');
      sec.style.display = (sec.style.display === 'none' || sec.style.display === '') ? 'block' : 'none';
    }

    function getFormData() {
      const form = document.getElementById('form8D');
      return {
        role: form.role.value,
        reportId: form.reportId.value,
        customer: form.customer.value,
        supplier: form.supplier.value,
        date: form.date.value,
        partNumber: form.partNumber.value,
        d1_team: form.d1_team.value,
        d2_problem: form.d2_problem.value,
        d3_containment: form.d3_containment.value,
        d4_tua: form.d4_tua.value,
        d4_tun: form.d4_tun.value,
        d4_sua: form.d4_sua.value,
        d4_sun: form.d4_sun.value,
        d5_occurrence: form.d5_occurrence.value,
        d5_detection: form.d5_detection.value,
        d6_implementation: getD6Data(),
        d7_preventive: form.d7_preventive.value,
        d8_verification: form.d8_verification.value,
        d8_closure: form.d8_closure.value
      };
    }

    function validateReport() {
      const data = getFormData();
      const dict = translations[currentLang];
      const missing = [];
      const plausibility = [];

      if (!data.reportId) missing.push(dict.head.reportId);
      if (!data.customer && !data.supplier) missing.push(dict.head.customer + " / " + dict.head.supplier);
      if (!data.date) missing.push(dict.head.date);
      if (!data.partNumber) missing.push(dict.head.partNumber);
      if (!data.d2_problem) missing.push("D2");
      if (!data.d3_containment) missing.push("D3");
      if (!data.d4_tua && !data.d4_tun && !data.d4_sua && !data.d4_sun)
        missing.push("D4 (TUA/TUN/SUA/SUN)");
      if (!data.d5_occurrence && !data.d5_detection)
        missing.push("D5 (Occurrence/Detection)");
      if (!data.d8_verification)
        missing.push("D8");

      // D4‚ÜíD5
      if ((data.d4_tua || data.d4_tun || data.d4_sua || data.d4_sun) &&
          !data.d5_occurrence && !data.d5_detection) {
        if (currentLang === 'de') {
          plausibility.push("F√ºr die in D4 beschriebenen Ursachen m√ºssen passende Ma√ünahmen in D5 definiert werden (Occurrence/Detection).");
        } else if (currentLang === 'en') {
          plausibility.push("For the root causes described in D4, appropriate corrective actions must be defined in D5 (Occurrence/Detection).");
        } else {
          plausibility.push("ÂØπ‰∫é D4 ‰∏≠ÊèèËø∞ÁöÑÊ†πÊú¨ÂéüÂõ†ÔºåÂøÖÈ°ªÂú® D5 ‰∏≠Âà∂ÂÆöÁõ∏Â∫îÁöÑÁ∫†Ê≠£Êé™ÊñΩÔºàÂèëÁîü / Ê£ÄÊµãÔºâ„ÄÇ");
        }
      }

      // D5‚ÜíD6
      if ((data.d5_occurrence || data.d5_detection) && (!data.d6_implementation || data.d6_implementation.length === 0)) {
        if (currentLang === 'de') {
          plausibility.push("D6 muss die Umsetzung der in D5 definierten Ma√ünahmen beschreiben (Wer, Was, Bis Wann, Status).");
        } else if (currentLang === 'en') {
          plausibility.push("D6 must describe the implementation of the corrective actions defined in D5 (Who, What, Due date, Status).");
        } else {
          plausibility.push("D6 ÂøÖÈ°ªÊèèËø∞Âú® D5 ‰∏≠ÂÆö‰πâÁöÑÁ∫†Ê≠£Êé™ÊñΩÁöÑÂÆûÊñΩÊÉÖÂÜµÔºàË¥£‰ªª‰∫∫„ÄÅÂÜÖÂÆπ„ÄÅÂÆåÊàêÊúüÈôê„ÄÅÁä∂ÊÄÅÔºâ„ÄÇ");
        }
      }

      // systemische Ursachen ‚Üí D7
      if ((data.d4_sua || data.d4_sun) && !data.d7_preventive) {
        if (currentLang === 'de') {
          plausibility.push("F√ºr systemische Ursachen (SUA/SUN) in D4 sollten in D7 vorbeugende Ma√ünahmen (Standards, FMEA, Schulung, Pr√ºfplan) definiert werden.");
        } else if (currentLang === 'en') {
          plausibility.push("For systemic causes (SUA/SUN) in D4, preventive actions should be defined in D7 (standards, FMEA, training, control plan).");
        } else {
          plausibility.push("ÂØπ‰∫é D4 ‰∏≠ÁöÑÁ≥ªÁªüÂéüÂõ†ÔºàSUA/SUNÔºâÔºåÂ∫îÂú® D7 ‰∏≠Âà∂ÂÆöÈ¢ÑÈò≤Êé™ÊñΩÔºàÊ†áÂáÜ„ÄÅFMEA„ÄÅÂüπËÆ≠„ÄÅÊéßÂà∂ËÆ°ÂàíÁ≠âÔºâ„ÄÇ");
        }
      }

      // Ma√ünahmen ohne Ursachen
      if (!data.d4_tua && !data.d4_tun && !data.d4_sua && !data.d4_sun &&
          (data.d5_occurrence || data.d5_detection)) {
        if (currentLang === 'de') {
          plausibility.push("Es sind Ma√ünahmen in D5 definiert, ohne dass in D4 Ursachen beschrieben sind. Bitte D4 zuerst vollst√§ndig ausarbeiten.");
        } else if (currentLang === 'en') {
          plausibility.push("Corrective actions are defined in D5, but no root causes are described in D4. Please complete D4 first.");
        } else {
          plausibility.push("Âú® D5 ‰∏≠Â∑≤ÁªèÂÆö‰πâ‰∫ÜÊé™ÊñΩÔºå‰ΩÜ D4 ‰∏≠Ê≤°ÊúâÊèèËø∞Ê†πÊú¨ÂéüÂõ†„ÄÇËØ∑ÂÖàÂÆåÊï¥Â°´ÂÜô D4„ÄÇ");
        }
      }

      const result = document.getElementById('validationResult');
      if (missing.length > 0) {
        result.className = "error";
        let text = dict.validation.missing + missing.join(", ");
        if (plausibility.length > 0) text += " | " + plausibility.join(" ");
        result.textContent = text;
      } else if (plausibility.length > 0) {
        result.className = "error";
        result.textContent = plausibility.join(" ");
      } else {
        result.className = "ok";
        result.textContent = dict.validation.ok;
      }
    }

    function buildPdfView() {
      const data = getFormData();

      document.getElementById('pdf_reportId').textContent = data.reportId || '';
      document.getElementById('pdf_date').textContent = data.date || '';
      document.getElementById('pdf_customer').textContent = data.customer || '';
      document.getElementById('pdf_supplier').textContent = data.supplier || '';
      document.getElementById('pdf_partNumber').textContent = data.partNumber || '';

      document.getElementById('pdf_d1').textContent = data.d1_team || '';
      document.getElementById('pdf_d2').textContent = data.d2_problem || '';
      document.getElementById('pdf_d3').textContent = data.d3_containment || '';

      document.getElementById('pdf_d4_tua').textContent = data.d4_tua || '';
      document.getElementById('pdf_d4_tun').textContent = data.d4_tun || '';
      document.getElementById('pdf_d4_sua').textContent = data.d4_sua || '';
      document.getElementById('pdf_d4_sun').textContent = data.d4_sun || '';

      document.getElementById('pdf_d5_occurrence').textContent = data.d5_occurrence || '';
      document.getElementById('pdf_d5_detection').textContent = data.d5_detection || '';

      // D6 Tabelle im PDF
      const d6Data = data.d6_implementation || [];
      let d6Html = '';
      if (d6Data.length > 0) {
        d6Html = '<table style="width:100%; border-collapse:collapse; font-size:7px; margin-top:2mm;">';
        d6Html += '<tr style="background:#eee;"><th style="border:1px solid #000; padding:1mm;">Ma√ünahme</th><th style="border:1px solid #000; padding:1mm;">Verantwortlicher</th><th style="border:1px solid #000; padding:1mm;">Termin</th><th style="border:1px solid #000; padding:1mm;">Status</th></tr>';
        d6Data.forEach(row => {
          d6Html += `<tr>
            <td style="border:1px solid #000; padding:1mm;">${row.action}</td>
            <td style="border:1px solid #000; padding:1mm;">${row.responsible}</td>
            <td style="border:1px solid #000; padding:1mm;">${row.date}</td>
            <td style="border:1px solid #000; padding:1mm;">${row.status}</td>
          </tr>`;
        });
        d6Html += '</table>';
      }
      document.getElementById('pdf_d6').innerHTML = d6Html;

      document.getElementById('pdf_d7').textContent = data.d7_preventive || '';
      document.getElementById('pdf_d8_verification').textContent = data.d8_verification || '';
      document.getElementById('pdf_d8_closure').textContent = data.d8_closure || '';

      const watermarkEl = document.getElementById('watermark');
      watermarkEl.textContent = translations[currentLang].watermark.text;
      watermarkEl.style.display = donated ? 'none' : 'block';
    }

    function exportPDF() {
      buildPdfView();
      const layout = document.getElementById('pdfLayout');
      layout.style.display = 'block';

      const opt = {
        margin: 0,
        filename: (document.getElementById('reportId').value || '8D-Report') + '.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      html2pdf().from(document.getElementById('pdfPage')).set(opt).save().then(() => {
        layout.style.display = 'none';
      });
    }

    function exportExcel() {
      const data = getFormData();
      const dict = translations[currentLang];
      const rows = [
        { Feld: dict.head.reportId, Wert: data.reportId },
        { Feld: dict.head.customer, Wert: data.customer },
        { Feld: dict.head.supplier, Wert: data.supplier },
        { Feld: dict.head.date, Wert: data.date },
        { Feld: dict.head.partNumber, Wert: data.partNumber },
        { Feld: dict.d1.title, Wert: data.d1_team },
        { Feld: dict.d2.title, Wert: data.d2_problem },
        { Feld: dict.d3.title, Wert: data.d3_containment },
        { Feld: dict.d4.tua, Wert: data.d4_tua },
        { Feld: dict.d4.tun, Wert: data.d4_tun },
        { Feld: dict.d4.sua, Wert: data.d4_sua },
        { Feld: dict.d4.sun, Wert: data.d4_sun },
        { Feld: dict.d5.occ, Wert: data.d5_occurrence },
        { Feld: dict.d5.det, Wert: data.d5_detection },
        { Feld: dict.d7.title, Wert: data.d7_preventive },
        { Feld: dict.d8.verif, Wert: data.d8_verification },
        { Feld: dict.d8.closure, Wert: data.d8_closure }
      ];

      const d6Data = data.d6_implementation || [];
      d6Data.forEach((item, idx) => {
        rows.push({
          Feld: `D6 Ma√ünahme ${idx + 1}`,
          Wert: `${item.action} | ${item.responsible} | ${item.date} | ${item.status}`
        });
      });

      const worksheet = XLSX.utils.json_to_sheet(rows);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, '8D-Report');
      const filename = (data.reportId || '8D-Report') + '.xlsx';
      XLSX.writeFile(workbook, filename);
    }

    function unlockFullVersion() {
      const code = prompt("Spenden-Code eingeben (Beispiel: DONATE2024):");
      if (code === "DONATE2024") {
        donated = true;
        alert("Vielen Dank f√ºr Ihre Spende! Wasserzeichen entfernt.");
      } else {
        alert("Ung√ºltiger Code.");
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      setLanguage("de");
    });
  </script>
</body>
</html>
